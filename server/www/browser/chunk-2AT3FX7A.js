import{Ea as o,Fa as p,Ga as v,Ha as f}from"./chunk-SHX6CIJO.js";import{R as b,W as l,pa as n}from"./chunk-DMKK32ZK.js";import{c as r}from"./chunk-IPDSYFFT.js";import{a as d,b as y,f as i}from"./chunk-RW4GY4BD.js";var k=(()=>{let c=class c{constructor(e){this.headersService=e,this.apiUrl=p.apiUrl,this.babies=n([]),this.activeBaby=n(void 0),this.loadActiveBaby()}loadActiveBaby(){return i(this,null,function*(){let e=yield o.get({key:"activeBaby"});if(e.value){let a=JSON.parse(e.value);this.activeBaby.set(a)}})}getActiveBaby(){return i(this,null,function*(){let e=yield o.get({key:"activeBaby"});if(e.value){let a=JSON.parse(e.value);this.activeBaby.set(a)}})}headers(){return i(this,null,function*(){return yield this.headersService.getHeaders()})}checkUserExists(){return i(this,null,function*(){(yield r.get({url:`${this.apiUrl}/user`,headers:yield this.headers()})).status===404&&(yield this.createUser())})}createUser(){return i(this,null,function*(){let e=yield v.getId();yield r.post({url:`${this.apiUrl}/user`,headers:yield this.headers(),data:{id:e.identifier}})})}makeBaby(e){return i(this,null,function*(){try{let t=(yield r.post({url:`${this.apiUrl}/baby`,headers:yield this.headers(),data:{name:e}})).data;return console.log("New baby",t),this.babies.update(s=>[...s,t]),this.activeBaby()||(yield this.setActiveBaby(t)),t}catch(a){throw console.error("Failed to create baby:",a),a}})}addBabyById(e){return i(this,null,function*(){let a=yield r.post({url:`${this.apiUrl}/baby/${e}/parent`,headers:yield this.headers(),data:{babyId:e}});return console.log("Baby",a.data),yield this.refresh(),a.data})}setActiveBaby(e){return i(this,null,function*(){yield o.set({key:"activeBaby",value:JSON.stringify(e)}),this.activeBaby.set(e)})}refresh(){return i(this,null,function*(){try{let e=yield r.get({url:`${this.apiUrl}/baby`,headers:yield this.headers()}),a=Array.isArray(e.data)?e.data:[];this.babies.set(a),a.length>0&&!this.activeBaby()&&(yield this.setActiveBaby(a[0]));let t=this.activeBaby();if(t){let s=a.some(w=>w.id===t.id);!s&&a.length>0?yield this.setActiveBaby(a[0]):s||this.activeBaby.set(void 0)}}catch(e){throw console.error("Failed to fetch babies:",e),this.babies.set([]),e}})}deleteBaby(e){return i(this,null,function*(){var a;try{if(yield r.delete({url:`${this.apiUrl}/baby/${e.id}`,headers:yield this.headers()}),this.babies.update(t=>t.filter(s=>s.id!==e.id)),((a=this.activeBaby())==null?void 0:a.id)===e.id){let t=this.babies();t.length>0?yield this.setActiveBaby(t[0]):this.activeBaby.set(void 0)}}catch(t){throw console.error("Failed to delete baby:",t),t}})}editBaby(e){return i(this,null,function*(){var a;try{yield r.put({url:`${this.apiUrl}/baby/${e.id}`,headers:yield this.headers(),data:{name:e.name}}),this.babies.update(t=>t.map(s=>s.id===e.id?y(d({},s),{name:e.name}):s)),((a=this.activeBaby())==null?void 0:a.id)===e.id&&(yield this.setActiveBaby(e))}catch(t){throw console.error("Failed to update baby:",t),t}})}};c.\u0275fac=function(a){return new(a||c)(l(f))},c.\u0275prov=b({token:c,factory:c.\u0275fac,providedIn:"root"});let h=c;return h})();export{k as a};
