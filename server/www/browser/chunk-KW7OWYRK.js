import{a as ve,b as De,c as be}from"./chunk-3E4VC7RP.js";import{b as Se}from"./chunk-TR4ZIYLD.js";import{a as de,d as pe,e as ue,f as me,m as _e,x as ge}from"./chunk-OWD54O6U.js";import{a as ye}from"./chunk-2AT3FX7A.js";import{Fa as fe,G as z,Ha as we,Y as X,Z as K,_ as U,aa as Y,c as G,ea as J,f as L,g as W,ga as Z,h as j,ha as ee,ia as te,la as ie,m as q,ma as ne,na as re,oa as oe,ra as se,va as ae,wa as le,za as ce}from"./chunk-SHX6CIJO.js";import{Ab as $,Fb as x,Ga as b,Gb as v,Hb as H,Ib as P,Ja as N,Pa as V,R as E,Rb as R,Tb as Q,W as T,Wa as f,X as D,ba as l,bb as n,ca as c,cb as s,db as g,hb as S,lb as d,mb as h,pa as y,qb as I,rb as O,sb as A,tb as C,ub as B,wb as w,yb as M,za as m,zb as k}from"./chunk-DMKK32ZK.js";import"./chunk-Z27GUSSL.js";import"./chunk-7KGURMOZ.js";import{c as he}from"./chunk-IPDSYFFT.js";import"./chunk-RJYTLPPS.js";import"./chunk-VJIVQHDH.js";import"./chunk-ZKRXQTCG.js";import"./chunk-G3CV3VGG.js";import"./chunk-JX3TYZ34.js";import"./chunk-RUY5SX76.js";import"./chunk-NIOQNOHM.js";import"./chunk-4U6PRYVA.js";import"./chunk-IL4VJRLA.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{f as _}from"./chunk-RW4GY4BD.js";var Ve=(()=>{let a=class a{constructor(e){this.headersService=e}getHistoryForBaby(i){return _(this,arguments,function*(e,t=new Date){return(yield he.get({url:`${fe.apiUrl}/report/${e}/history/${t.toISOString().split("T")[0]}`,headers:yield this.headersService.getHeaders()})).data})}};a.\u0275fac=function(t){return new(t||a)(T(we))},a.\u0275prov=E({token:a,factory:a.\u0275fac,providedIn:"root"});let p=a;return p})();var ke=["sleepModal"],xe=["diaperModal"],Fe=["nursingModal"],Pe=["sleepForm"],Ee=["diaperForm"],Te=["nursingForm"],Ne=["accordionGroup"],Ce=()=>[0,.6,.75,1],Ie=()=>[0,.5,.75,1];function Oe(p,a){if(p&1){let r=S();n(0,"ion-item",21),g(1,"ion-ripple-effect"),n(2,"ion-label",22),d("click",function(){let t=l(r).$implicit,i=h();return c(i.editSleep(t))}),w(3),v(4,"date"),v(5,"date"),v(6,"number"),s(),n(7,"ion-button",23),d("click",function(){let t=l(r).$implicit,i=h();return c(i.editSleep(t))}),g(8,"ion-icon",24),s(),n(9,"ion-button",25),d("click",function(){let t=l(r).$implicit,i=h();return c(i.showDeleteSleepAlert(t))}),g(10,"ion-icon",26),s()()}if(p&2){let r=a.$implicit,e=h();m(3),$(" ",H(4,3,r.start,"HH:mm")," - ",H(5,6,r.end,"HH:mm")," - (",H(6,9,e.calculateDurationInHours(r.start,r.end),"1.0-2")," hours) ")}}function Ae(p,a){if(p&1){let r=S();n(0,"ion-item",21),g(1,"ion-ripple-effect"),n(2,"ion-label",22),d("click",function(){let t=l(r).$implicit,i=h();return c(i.editDiaper(t))}),w(3),v(4,"date"),s(),n(5,"ion-button",23),d("click",function(){let t=l(r).$implicit,i=h();return c(i.editDiaper(t))}),g(6,"ion-icon",24),s(),n(7,"ion-button",25),d("click",function(){let t=l(r).$implicit,i=h();return c(i.showDeleteDiaperAlert(t))}),g(8,"ion-icon",26),s()()}if(p&2){let r=a.$implicit;m(3),k(" ",P(4,2,r.time,"HH:mm","da-DK")," - (",r.type,") ")}}function Be(p,a){if(p&1){let r=S();n(0,"ion-item",21),g(1,"ion-ripple-effect"),n(2,"ion-label",22),d("click",function(){let t=l(r).$implicit,i=h();return c(i.editNursing(t))}),w(3),v(4,"date"),s(),n(5,"ion-button",23),d("click",function(){let t=l(r).$implicit,i=h();return c(i.editNursing(t))}),g(6,"ion-icon",24),s(),n(7,"ion-button",25),d("click",function(){let t=l(r).$implicit,i=h();return c(i.showDeleteNursingAlert(t))}),g(8,"ion-icon",26),s()()}if(p&2){let r=a.$implicit;m(3),k(" ",P(4,2,r.time,"HH:mm","da-DK")," - (",r.type,") ")}}function $e(p,a){if(p&1){let r=S();n(0,"ion-content",27)(1,"app-sleep-form",28,4),d("sleepOutput",function(t){l(r);let i=h();return c(i.onSleepEdit(t))}),s()()}}function Re(p,a){if(p&1){let r=S();n(0,"ion-content",27)(1,"app-diaper-form",29,5),d("diaperOutput",function(t){l(r);let i=h();return c(i.onDiaperEdit(t))}),s()()}}function Qe(p,a){if(p&1){let r=S();n(0,"ion-content",27)(1,"app-nursing-form",30,6),d("nursingOutput",function(t){l(r);let i=h();return c(i.onNursingEdit(t))}),s()()}}var ct=(()=>{let a=class a{constructor(){this.storageService=D(Se),this.historyService=D(Ve),this.alertController=D(ae),this.router=D(q),this.babyService=D(ye),this.date=y(new Date),this.sleeps=y([]),this.diapers=y([]),this.nursings=y([]),this.totalSleepDuration=R(()=>{let e=this.sleeps();return!e||!Array.isArray(e)?0:e.reduce((t,i)=>!i.start||!i.end?t:t+this.calculateDurationInHours(i.start,i.end),0)}),this.gestureCtrl=D(le),this.sleepModal=b("sleepModal"),this.diaperModal=b("diaperModal"),this.nursingModal=b("nursingModal"),this.sleepForm=b("sleepForm"),this.diaperForm=b("diaperForm"),this.nursingForm=b("nursingForm"),this.selectedSleep=y(void 0),this.selectedDiaper=y(void 0),this.selectedNursing=y(void 0),de({arrowBackOutline:ue,pencilOutline:_e,trashOutline:ge,addOutline:pe,arrowForwardOutline:me}),Q(()=>{this.date(),this.ionViewWillEnter()})}ionViewWillEnter(){return _(this,null,function*(){if(this.babyService.activeBaby()){console.log("active baby",this.babyService.activeBaby());let e=yield this.historyService.getHistoryForBaby(this.babyService.activeBaby().id,this.date());this.sleeps.set(e.sleeps||[]),this.diapers.set(e.diapers||[]),this.nursings.set(e.nursings||[]),console.log(e);let t=[];this.sleeps()&&this.sleeps().length>0&&t.push("sleep"),this.diapers()&&this.diapers().length>0&&t.push("diapers"),this.nursings()&&this.nursings().length>0&&t.push("nursings"),this.accordionGroup.value=t}})}showDeleteDiaperAlert(e){return _(this,null,function*(){yield(yield this.alertController.create({header:"Delete Diaper",message:"Are you sure you want to delete this diaper?",buttons:["Cancel",{text:"Delete",handler:()=>this.deleteDiaper(e)}]})).present()})}deleteDiaper(e){return _(this,null,function*(){e.id&&(yield this.storageService.deleteDiaper(e.id)),this.diapers.set(this.diapers().filter(t=>t.id!==e.id))})}showDeleteSleepAlert(e){return _(this,null,function*(){yield(yield this.alertController.create({header:"Delete Sleep",message:"Are you sure you want to delete this sleep?",buttons:["Cancel",{text:"Delete",handler:()=>this.deleteSleep(e)}]})).present()})}deleteSleep(e){return _(this,null,function*(){e.id&&(yield this.storageService.deleteSleep(e.id)),this.sleeps.set(this.sleeps().filter(t=>t.id!==e.id))})}showDeleteNursingAlert(e){return _(this,null,function*(){yield(yield this.alertController.create({header:"Delete Nursing",message:"Are you sure you want to delete this nursing?",buttons:["Cancel",{text:"Delete",handler:()=>this.deleteNursing(e)}]})).present()})}deleteNursing(e){return _(this,null,function*(){e.id&&(yield this.storageService.deleteNursing(e.id)),this.nursings.set(this.nursings().filter(t=>t.id!==e.id))})}goToHome(){this.router.navigate(["/home"])}ionViewDidEnter(){let e=document.querySelector("ion-row"),t=document.querySelector("ion-content");if(!e||!t){console.error("Could not find required elements");return}let i=this.gestureCtrl.create({el:t,threshold:15,gestureName:"swipe",gesturePriority:100,direction:"x",onStart:()=>{console.log("Gesture started")},onMove:o=>{console.log("Gesture moving:",o.deltaX);let u=o.deltaX;Math.abs(o.deltaY)>Math.abs(u)||(u>50?(this.animateAndChangePage("right",t),i.enable(!1),setTimeout(()=>i.enable(!0),500)):u<-50&&(this.animateAndChangePage("left",t),i.enable(!1),setTimeout(()=>i.enable(!0),500)))}});i.enable(!0)}animateAndChangePage(e,t){t.classList.add("page-transition"),t.classList.add("fade-out"),setTimeout(()=>{e==="right"?this.previousDay():this.nextDay(),t.classList.remove("fade-out"),t.classList.add("fade-in"),setTimeout(()=>{t.classList.remove("page-transition","fade-in")},300)},150)}previousDay(){let e=new Date(this.date());e.setDate(e.getDate()-1),this.date.set(e)}nextDay(){let e=new Date(this.date());e.setDate(e.getDate()+1),this.date.set(e)}calculateDurationInHours(e,t){let i=new Date(e),u=new Date(t).getTime()-i.getTime();return Math.floor(u/6e4)/60}editSleep(e){var t;this.selectedSleep.set(e),this.sleepForm().initializeForm(e),(t=this.sleepModal())==null||t.present()}editDiaper(e){var t;this.selectedDiaper.set(e),this.diaperForm().initializeForm(e),(t=this.diaperModal())==null||t.present()}editNursing(e){var t;this.selectedNursing.set(e),this.nursingForm().initializeForm(e),(t=this.nursingModal())==null||t.present()}onSleepEdit(e){return _(this,null,function*(){var t,i;if(e){let o=e.start.getHours(),u=e.start.getMinutes();e.start=new Date(this.date()),e.start.setHours(o),e.start.setMinutes(u);let F=e.end.getHours(),He=e.end.getMinutes();e.end=new Date(this.date()),e.end.setHours(F),e.end.setMinutes(He),e.id=(t=this.selectedSleep())==null?void 0:t.id,e.id?yield this.storageService.editSleep(e):yield this.storageService.addSleep(e)}(i=this.sleepModal())==null||i.dismiss(),this.selectedSleep.set(void 0),this.ionViewWillEnter()})}onDiaperEdit(e){return _(this,null,function*(){var t,i;if(e){let o=e.time.getHours(),u=e.time.getMinutes();e.time=new Date(this.date()),e.time.setHours(o),e.time.setMinutes(u),e.id=(t=this.selectedDiaper())==null?void 0:t.id,e.id?yield this.storageService.editDiaper(e):yield this.storageService.addDiaper(e)}(i=this.diaperModal())==null||i.dismiss(),this.selectedDiaper.set(void 0),this.ionViewWillEnter()})}onNursingEdit(e){return _(this,null,function*(){var t,i;if(e){let o=e.time.getHours(),u=e.time.getMinutes();e.time=new Date(this.date()),e.time.setHours(o),e.time.setMinutes(u),e.id=(t=this.selectedNursing())==null?void 0:t.id,e.id?yield this.storageService.editNursing(e):yield this.storageService.addNursing(e)}(i=this.nursingModal())==null||i.dismiss(),this.selectedNursing.set(void 0),this.ionViewWillEnter()})}addNewSleep(){return _(this,null,function*(){var t;let e=this.sleepForm();e&&(yield e.reset(),this.selectedSleep.set(void 0),yield(t=this.sleepModal())==null?void 0:t.present())})}addNewDiaper(){return _(this,null,function*(){var t;let e=this.diaperForm();e&&(yield e.reset(),this.selectedDiaper.set(void 0),yield(t=this.diaperModal())==null?void 0:t.present())})}addNewNursing(){return _(this,null,function*(){var t;let e=this.nursingForm();e&&(yield e.reset(),this.selectedNursing.set(void 0),yield(t=this.nursingModal())==null?void 0:t.present())})}handleRefresh(e){return _(this,null,function*(){yield this.ionViewWillEnter(),setTimeout(()=>{e.target.complete()},500)})}};a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=N({type:a,selectors:[["app-history"]],viewQuery:function(t,i){if(t&1&&(C(i.sleepModal,ke,5),C(i.diaperModal,xe,5),C(i.nursingModal,Fe,5),C(i.sleepForm,Pe,5),C(i.diaperForm,Ee,5),C(i.nursingForm,Te,5),I(Ne,7)),t&2){B(6);let o;O(o=A())&&(i.accordionGroup=o.first)}},decls:56,vars:31,consts:[["accordionGroup",""],["sleepModal",""],["diaperModal",""],["nursingModal",""],["sleepForm",""],["diaperForm",""],["nursingForm",""],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],["fill","clear",3,"click"],["name","arrow-back-outline"],[3,"multiple"],[3,"value"],["slot","header"],["slot","content","inset","true"],["class","ion-activatable",4,"ngFor","ngForOf"],["fill","clear","expand","block",3,"click"],["color","primary","name","add-outline"],[2,"display","flex","justify-content","space-between","align-items","center"],["name","arrow-forward-outline"],[3,"willDismiss","breakpoints","initialBreakpoint","keepContentsMounted"],[1,"ion-activatable"],[3,"click"],["fill","clear","slot","end",3,"click"],["name","pencil-outline"],["fill","clear","slot","end","color","danger",3,"click"],["name","trash-outline"],[1,"ion-padding"],[3,"sleepOutput"],[3,"diaperOutput"],[3,"nursingOutput"]],template:function(t,i){if(t&1){let o=S();n(0,"ion-content",7)(1,"ion-refresher",8),d("ionRefresh",function(F){return l(o),c(i.handleRefresh(F))}),g(2,"ion-refresher-content"),s(),n(3,"ion-row")(4,"ion-button",9),d("click",function(){return l(o),c(i.goToHome())}),g(5,"ion-icon",10),s(),n(6,"ion-title"),w(7),v(8,"date"),s()(),n(9,"ion-accordion-group",11,0)(11,"ion-accordion",12)(12,"ion-item",13)(13,"ion-label"),w(14),v(15,"number"),s()(),n(16,"ion-list",14),V(17,Oe,11,12,"ion-item",15),n(18,"ion-item")(19,"ion-button",16),d("click",function(){return l(o),c(i.addNewSleep())}),g(20,"ion-icon",17),w(21," Add New Sleep "),s()()()(),n(22,"ion-accordion",12)(23,"ion-item",13)(24,"ion-label"),w(25),s()(),n(26,"ion-list",14),V(27,Ae,9,6,"ion-item",15),n(28,"ion-item")(29,"ion-button",16),d("click",function(){return l(o),c(i.addNewDiaper())}),g(30,"ion-icon",17),w(31," Add New Diaper "),s()()()(),n(32,"ion-accordion",12)(33,"ion-item",13)(34,"ion-label"),w(35),s()(),n(36,"ion-list",14),V(37,Be,9,6,"ion-item",15),n(38,"ion-item")(39,"ion-button",16),d("click",function(){return l(o),c(i.addNewNursing())}),g(40,"ion-icon",17),w(41," Add New Nursing "),s()()()()(),n(42,"div",18)(43,"ion-button",16),d("click",function(){return l(o),c(i.previousDay())}),g(44,"ion-icon",10),s(),n(45,"ion-button",16),d("click",function(){return l(o),c(i.nextDay())}),g(46,"ion-icon",19),s()(),n(47,"ion-modal",20,1),d("willDismiss",function(){return l(o),c(i.sleepForm().reset())}),V(49,$e,3,0,"ng-template"),s(),n(50,"ion-modal",20,2),d("willDismiss",function(){return l(o),c(i.diaperForm().reset())}),V(52,Re,3,0,"ng-template"),s(),n(53,"ion-modal",20,3),d("willDismiss",function(){return l(o),c(i.nursingForm().reset())}),V(55,Qe,3,0,"ng-template"),s()()}if(t&2){let o;f("fullscreen",!0),m(7),k("Overview - ",(o=i.babyService.activeBaby())==null?null:o.name," - ",H(8,22,i.date(),"dd/MM/yy"),""),m(2),f("multiple",!0),m(2),f("value","sleep"),m(3),M("Sleep: ",H(15,25,i.totalSleepDuration(),"1.0-2")," hours"),m(3),f("ngForOf",i.sleeps()),m(5),f("value","diapers"),m(3),M("Diapers: ",i.diapers().length,""),m(2),f("ngForOf",i.diapers()),m(5),f("value","nursings"),m(3),M("Nursings: ",i.nursings().length,""),m(2),f("ngForOf",i.nursings()),m(10),f("breakpoints",x(28,Ce))("initialBreakpoint",.6)("keepContentsMounted",!0),m(3),f("breakpoints",x(29,Ce))("initialBreakpoint",.6)("keepContentsMounted",!0),m(3),f("breakpoints",x(30,Ie))("initialBreakpoint",.75)("keepContentsMounted",!0)}},dependencies:[J,se,j,G,W,L,z,te,Z,ee,Y,ce,oe,ve,De,be,X,U,K,re,ie,ne],styles:[".page-transition[_ngcontent-%COMP%]{transition:opacity .3s ease-out}.fade-out[_ngcontent-%COMP%]{opacity:0}.fade-in[_ngcontent-%COMP%]{opacity:1;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}ion-button[_ngcontent-%COMP%]{font-size:inherit;font-weight:inherit;margin-left:-10px}"]});let p=a;return p})();export{ct as HistoryPage};
