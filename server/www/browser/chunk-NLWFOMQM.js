import{a as ce,b as de}from"./chunk-EPV4WW5H.js";import{a as se,b as le,c as pe}from"./chunk-3E4VC7RP.js";import{b as ae}from"./chunk-TR4ZIYLD.js";import{a as re,e as oe}from"./chunk-OWD54O6U.js";import"./chunk-2AT3FX7A.js";import{Y as U,aa as X,b as q,ba as Y,ea as Z,f as K,g as W,h as G,m as J,ra as ee,sa as te,ta as ie,za as ne}from"./chunk-SHX6CIJO.js";import{$a as T,Ab as R,Fb as k,Ga as _,Gb as P,Hb as L,Ja as V,Jb as j,Pa as F,Wa as D,X as x,Xa as A,Za as I,_a as B,ab as E,ba as f,bb as l,ca as v,cb as p,db as z,hb as w,lb as y,mb as S,pa as O,tb as h,ub as $,wb as C,xb as H,yb as Q,za as d,zb as N}from"./chunk-DMKK32ZK.js";import"./chunk-Z27GUSSL.js";import"./chunk-7KGURMOZ.js";import"./chunk-IPDSYFFT.js";import"./chunk-RJYTLPPS.js";import"./chunk-VJIVQHDH.js";import"./chunk-ZKRXQTCG.js";import"./chunk-G3CV3VGG.js";import"./chunk-JX3TYZ34.js";import"./chunk-RUY5SX76.js";import"./chunk-NIOQNOHM.js";import"./chunk-4U6PRYVA.js";import"./chunk-IL4VJRLA.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{f as g}from"./chunk-RW4GY4BD.js";var ue=["sleepModal"],ge=["diaperModal"],_e=["nursingModal"],he=["sleepForm"],fe=["diaperForm"],ve=["nursingForm"],we=(r,o)=>o.hour+"-"+o.minutes[0],ye=(r,o)=>o.text,b=()=>[0,.5,.75,1];function Se(r,o){if(r&1){let s=w();l(0,"div",7),y("click",function(){let t=f(s).$implicit,i=S(3);return v(i.onActivityClick(t))}),C(1),p()}if(r&2){let s=o.$implicit;I("activity ",s.type,""),d(),Q(" ",s.text," ")}}function Ce(r,o){if(r&1&&(l(0,"div",14)(1,"div",15),C(2),p(),l(3,"div",16),T(4,Se,2,4,"div",17,ye),p()()),r&2){let s=o.$implicit;A("sleeping",s.isSleeping),d(2),N(" ",s.hour,".",s.minutes[0]===0?"00":s.minutes[0]," "),d(2),E(s.activities)}}function Me(r,o){if(r&1&&(l(0,"div",11),T(1,Ce,6,4,"div",13,we),p()),r&2){let s=S();d(),E(s.timeSlots)}}function xe(r,o){r&1&&(l(0,"p"),C(1,"Loading..."),p())}function Fe(r,o){if(r&1){let s=w();l(0,"ion-content",10)(1,"app-sleep-form",18,3),y("sleepOutput",function(t){f(s);let i=S();return v(i.onSleepEdit(t))}),p()()}}function De(r,o){if(r&1){let s=w();l(0,"ion-content",10)(1,"app-diaper-form",19,4),y("diaperOutput",function(t){f(s);let i=S();return v(i.onDiaperEdit(t))}),p()()}}function ke(r,o){if(r&1){let s=w();l(0,"ion-content",10)(1,"app-nursing-form",20,5),y("nursingOutput",function(t){f(s);let i=S();return v(i.onNursingEdit(t))}),p()()}}q(de);var je=(()=>{let o=class o{constructor(){this.reportService=x(ce),this.storageService=x(ae),this.router=x(J),this.modalController=x(ie),this.report=O(null),this.currentDate=new Date,this.timeSlots=[],this.sleepModal=_("sleepModal"),this.diaperModal=_("diaperModal"),this.nursingModal=_("nursingModal"),this.sleepForm=_("sleepForm"),this.diaperForm=_("diaperForm"),this.nursingForm=_("nursingForm"),this.selectedActivity=null,re({arrowBackOutline:oe}),this.initializeTimeSlots()}initializeTimeSlots(){this.timeSlots=[];for(let e=0;e<24;e++)this.timeSlots.push({hour:e,minutes:[0,15,30,45],activities:[],isSleeping:!1})}updateActivities(e){this.initializeTimeSlots(),e.sleeps.forEach(t=>{let i=new Date(t.start),n=new Date(t.end),c=i.getHours(),m=n.getHours(),M=this.timeSlots.find(a=>a.hour===c);M&&M.activities.push({type:"sleep",text:`Sleep: ${i.getHours()}.${i.getMinutes().toString().padStart(2,"0")} - ${n.getHours()}.${n.getMinutes().toString().padStart(2,"0")}`,sleep:{start:new Date(t.start),end:new Date(t.end),id:t.id}});for(let a=c;a<=m;a++){let u=this.timeSlots.find(me=>me.hour===a);u&&(u.isSleeping=!0)}}),e.diapers.forEach(t=>{let n=new Date(t.time).getHours(),c=this.timeSlots.find(m=>m.hour===n);c&&c.activities.push({type:"diaper",text:`Diaper: ${t.type}`,diaper:{id:t.id,type:t.type,time:new Date(t.time)}})}),e.nursings.forEach(t=>{let n=new Date(t.time).getHours(),c=this.timeSlots.find(m=>m.hour===n);c&&c.activities.push({type:"nursing",text:`Nursing: ${t.type}`,nursing:{id:t.id,type:t.type,time:new Date(t.time),amount:t.amount}})})}ionViewWillEnter(){return g(this,null,function*(){try{let e=yield this.reportService.getDailyReport();console.log(e),this.report.set(e),e&&this.updateActivities(e)}catch(e){console.error("Failed to load report:",e)}})}goBack(){this.router.navigate(["/home"])}onActivityClick(e){return g(this,null,function*(){var t,i,n,c,m,M;switch(this.selectedActivity=e,e.type){case"sleep":if(e.sleep){yield(t=this.sleepForm())==null?void 0:t.reset();let a=new Date(e.sleep.start),u=new Date(e.sleep.end);a.setMinutes(a.getMinutes()-a.getTimezoneOffset()),u.setMinutes(u.getMinutes()-u.getTimezoneOffset()),this.sleepForm().sleepStart.set(a),this.sleepForm().sleepEnd.set(u),yield(i=this.sleepModal())==null?void 0:i.present()}break;case"diaper":if(e.diaper){yield(n=this.diaperForm())==null?void 0:n.reset(),this.diaperForm().form.patchValue({type:e.diaper.type});let a=new Date(e.diaper.time);a.setMinutes(a.getMinutes()-a.getTimezoneOffset()),this.diaperForm().time.set(a),yield(c=this.diaperModal())==null?void 0:c.present()}break;case"nursing":if(e.nursing){yield(m=this.nursingForm())==null?void 0:m.reset();let a=new Date(e.nursing.time);a.setMinutes(a.getMinutes()-a.getTimezoneOffset()),this.nursingForm().nursing.set({type:e.nursing.type,time:a,amount:e.nursing.amount}),yield(M=this.nursingModal())==null?void 0:M.present()}break}})}onSleepEdit(e){return g(this,null,function*(){var t,i,n;e&&((i=(t=this.selectedActivity)==null?void 0:t.sleep)!=null&&i.id)&&(e.id=this.selectedActivity.sleep.id,yield this.storageService.editSleep(e),yield this.refreshData()),yield(n=this.sleepModal())==null?void 0:n.dismiss()})}onDiaperEdit(e){return g(this,null,function*(){var t,i,n;e&&((i=(t=this.selectedActivity)==null?void 0:t.diaper)!=null&&i.id)&&(e.id=this.selectedActivity.diaper.id,yield this.storageService.editDiaper(e),yield this.refreshData()),yield(n=this.diaperModal())==null?void 0:n.dismiss()})}onNursingEdit(e){return g(this,null,function*(){var t,i,n;e&&((i=(t=this.selectedActivity)==null?void 0:t.nursing)!=null&&i.id)&&(e.id=this.selectedActivity.nursing.id,yield this.storageService.editNursing(e),yield this.refreshData()),yield(n=this.nursingModal())==null?void 0:n.dismiss()})}refreshData(){return g(this,null,function*(){let e=yield this.reportService.getDailyReport();this.report.set(e),e&&this.updateActivities(e)})}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=V({type:o,selectors:[["app-calendar"]],viewQuery:function(t,i){t&1&&(h(i.sleepModal,ue,5),h(i.diaperModal,ge,5),h(i.nursingModal,_e,5),h(i.sleepForm,he,5),h(i.diaperForm,fe,5),h(i.nursingForm,ve,5)),t&2&&$(6)},decls:22,vars:25,consts:[["sleepModal",""],["diaperModal",""],["nursingModal",""],["sleepForm",""],["diaperForm",""],["nursingForm",""],["slot","start"],[3,"click"],["name","arrow-back-outline"],["size","small"],[1,"ion-padding"],[1,"calendar-container"],[3,"breakpoints","initialBreakpoint","keepContentsMounted"],[1,"time-slot",3,"sleeping"],[1,"time-slot"],[1,"time"],[1,"activities"],[3,"class"],[3,"sleepOutput"],[3,"diaperOutput"],[3,"nursingOutput"]],template:function(t,i){if(t&1){let n=w();l(0,"ion-toolbar")(1,"ion-buttons",6)(2,"ion-button",7),y("click",function(){return f(n),v(i.goBack())}),z(3,"ion-icon",8),p()(),l(4,"ion-title"),C(5),P(6,"date"),p(),l(7,"ion-title",9),C(8),P(9,"number"),p()(),l(10,"ion-content",10),F(11,Me,3,0,"div",11)(12,xe,2,0,"p"),p(),l(13,"ion-modal",12,0),F(15,Fe,3,0,"ng-template"),p(),l(16,"ion-modal",12,1),F(18,De,3,0,"ng-template"),p(),l(19,"ion-modal",12,2),F(21,ke,3,0,"ng-template"),p()}if(t&2){let n;d(5),H(j(6,14,i.currentDate,"dd/MM/yyyy","","da-DK")),d(3),R("Sleep: ",L(9,19,i.storageService.totalHoursSlept(),"1.0-1")," hours - Diapers: ",i.storageService.totalDiapersToday().length," - Nursing: ",i.storageService.totalNursingsToday().length,""),d(3),B((n=i.report())?11:12,n),d(2),D("breakpoints",k(22,b))("initialBreakpoint",.5)("keepContentsMounted",!0),d(3),D("breakpoints",k(23,b))("initialBreakpoint",.5)("keepContentsMounted",!0),d(3),D("breakpoints",k(24,b))("initialBreakpoint",.5)("keepContentsMounted",!0)}},dependencies:[G,W,K,Z,te,ee,Y,X,ne,U,le,pe,se],styles:[".calendar-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:0;border:1px solid var(--ion-color-light)}.time-slot[_ngcontent-%COMP%]{display:flex;min-height:30px;border-bottom:1px solid var(--ion-color-light);transition:background-color .2s ease}.time-slot.sleeping[_ngcontent-%COMP%]{background-color:var(--ion-color-primary-tint);color:var(--ion-color-primary-contrast)}.time[_ngcontent-%COMP%]{width:60px;padding:4px;font-size:14px;border-right:1px solid var(--ion-color-light)}.activities[_ngcontent-%COMP%]{flex:1;padding:4px}.activity[_ngcontent-%COMP%]{padding:2px 8px;margin:2px 0;border-radius:4px;font-size:14px;cursor:pointer;transition:opacity .2s ease}.activity[_ngcontent-%COMP%]:hover{opacity:.8}.activity.sleep[_ngcontent-%COMP%]{background-color:var(--ion-color-primary);color:var(--ion-color-primary-contrast)}.activity.nursing[_ngcontent-%COMP%]{background-color:var(--ion-color-warning);color:var(--ion-color-warning-contrast)}.activity.diaper[_ngcontent-%COMP%]{background-color:var(--ion-color-success);color:var(--ion-color-success-contrast)}"]});let r=o;return r})();export{je as CalendarPage};
